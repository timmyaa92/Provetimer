<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<style>
  :root {
    --bg: #f5f5f5;
    --text: #222;
    --card: #e6e6e6;
    --running: #86e686;
    --finished: #ff8b8b;
    --button: #4a90e2;
    --button-text: #ffffff;
    --border: #bdbdbd;
    --muted: #6b6b6b;
  }

  body.dark {
    --bg: #1f1f1f;
    --text: #e2e2e2;
    --card: #2c2c2c;
    --running: #2e8f2e;
    --finished: #993333;
    --button: #616161;
    --button-text: #ffffff;
    --border: #444;
    --muted: #9a9a9a;
  }

  body {
    background: radial-gradient(1200px 800px at 50% -10%, #ffffff20, transparent), var(--bg);
    color: var(--text);
    font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Helvetica, sans-serif;
    margin: 0;
    padding: 24px 16px 40px;
    text-align: center;
    transition: background 0.3s, color 0.3s;
  }

  .app { max-width: 1200px; margin: 0 auto; }

  .logo {
    font-size: 22px; font-weight: 700; opacity: 0.75;
    margin-bottom: 6px; letter-spacing: 0.3px;
  }

  h1 { margin: 0 0 12px; font-size: 34px; letter-spacing: 0.2px; }

  .topbar {
    display: flex; justify-content: center; gap: 10px; margin-bottom: 16px;
  }

  .row {
    display: flex; flex-wrap: wrap; gap: 10px 12px;
    align-items: center; justify-content: center; margin-bottom: 10px;
  }

  input[type="text"], textarea, input[type="number"] {
    padding: 10px 12px; font-size: 16px; border-radius: 8px;
    border: 1px solid var(--border); background: #ffffff; color: #000;
  }
  body.dark input[type="text"], body.dark textarea, body.dark input[type="number"] {
    background: #1a1a1a; color: var(--text); border-color: var(--border);
  }

  label { font-size: 16px; }
  .muted { color: var(--muted); font-size: 13px; }

  button {
    padding: 10px 16px; font-size: 15px; cursor: pointer; border-radius: 8px;
    background: var(--button); color: var(--button-text); border: none;
    transition: transform 0.15s ease, filter 0.2s ease, opacity 0.2s ease;
    user-select: none;
  }
  button:hover { transform: translateY(-1px); }
  button:active { transform: translateY(0); }

  .btn-secondary { background: transparent; color: var(--text); border: 1px solid var(--border); }
  .btn-danger { background: #d9534f; }

  .panel {
    background: color-mix(in oklab, var(--card) 92%, transparent);
    border: 1px solid var(--border); border-radius: 12px; padding: 14px; margin-bottom: 16px;
  }

  /* Elever-grid */
  #studentList {
    display: grid; grid-template-columns: repeat(5, 1fr);
    gap: 14px; margin-top: 6px;
  }

  .student {
    padding: 10px; font-size: 20px; background-color: var(--card);
    border: 1px solid var(--border); border-radius: 12px;
    transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease;
    position: relative; user-select: none; box-shadow: 0 1px 0 rgba(0,0,0,0.02); min-height: 96px;
  }
  .student:hover { transform: translateY(-2px); }

  .running { background-color: var(--running) !important; }
  .finished { background-color: var(--finished) !important; }

  .deleteBtn {
    position: absolute; top: 8px; right: 8px; background: transparent; border: none;
    color: inherit; font-size: 20px; cursor: pointer; padding: 4px; line-height: 1;
  }

  .name { font-weight: 700; display: block; margin-bottom: 6px; font-size: 19px; }
  .time { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 18px; }

  /* Responsivitet */
  @media (max-width: 1024px) { #studentList { grid-template-columns: repeat(3, 1fr); } }
  @media (max-width: 820px)  { #studentList { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 520px)  { #studentList { grid-template-columns: 1fr; } }
</style>
</head>

<body>
<div class="app">

  <div class="logo">üìö</div>
  <h1>Lesepr√∏ve‚Äëtimer</h1>

  <div class="topbar">
    <button class="btn-secondary" onclick="toggleDarkMode()">üåì M√∏rk modus</button>
    <span id="statusText" class="muted"></span>
  </div>

  <div class="panel">
    <div class="row">
      <input type="text" id="nameInput" placeholder="Skriv elevnavn">
      <button onclick="addStudent()">Legg til elev</button>
    </div>

    <div class="row">
      <label for="maxMinutes"><strong>Maks tid (minutter):</strong></label>
      <input type="number" id="maxMinutes" min="1" max="240" value="10" style="width: 100px;">
      <span class="muted">Settes f√∏r start</span>
    </div>

    <div class="row">
      <button onclick="startAll()">‚ñ∂Ô∏è START FOR ALLE</button>
      <button class="btn-secondary" onclick="sortStudents()">Sorter A‚Äì√Ö</button>
      <button class="btn-danger" onclick="restartTimer()">üîÅ Nullstill</button>
      <button onclick="exportXLSX()">‚¨áÔ∏è Eksporter tider</button>
    </div>
  </div>

  <div class="panel">
    <div class="row" style="margin-top: 6px;">
      <textarea id="pasteArea" rows="5" cols="50" placeholder="Lim inn elevliste her (√©n elev per linje)"></textarea>
    </div>
    <div class="row">
      <button onclick="importStudents()">üì• Importer</button>
    </div>
  </div>

  <div id="studentList"></div>

</div>

<!-- SheetJS for √• generere ekte .xlsx i nettleseren -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
  let students = [];
  let interval = null;
  let globalTime = 0;
  let maxTime = 600; // sekunder (settes fra input f√∏r start)
  let timerRunning = false; // skjul sletting under √∏kt

  // ---- M√∏rk modus ----
  function toggleDarkMode() {
    document.body.classList.toggle("dark");
  }

  // ---- Legg til elev ----
  function addStudent() {
    const nameInput = document.getElementById("nameInput");
    const name = nameInput.value.trim();
    if (name === "") return;

    students.push({ name, time: 0, active: false, finished: false });
    nameInput.value = "";
    renderStudents();
  }

  // ---- Import ----
  function importStudents() {
    const area = document.getElementById("pasteArea");
    const text = area.value.trim();
    if (text === "") return;

    const lines = text.split(/\r?\n/);
    lines.forEach(line => {
      const name = line.trim();
      if (name !== "") {
        students.push({ name, time: 0, active: false, finished: false });
      }
    });

    area.value = "";
    renderStudents();
  }

  // ---- Hent maks-tid ----
  function getMaxTimeFromInput() {
    const input = document.getElementById("maxMinutes");
    let min = parseInt(input.value, 10);
    if (isNaN(min) || min < 1) min = 10;
    if (min > 240) min = 240;
    input.value = String(min);
    return min * 60;
  }

  // ---- Start for alle ----
  function startAll() {
    if (interval !== null) return;

    maxTime = getMaxTimeFromInput();
    globalTime = 0;

    students.forEach(s => { if (!s.finished) s.active = true; });

    timerRunning = true;
    updateStatus();
    renderStudents();

    interval = setInterval(() => {
      globalTime++;
      students.forEach(s => { if (s.active) s.time++; });

      if (globalTime >= maxTime) {
        stopAll();
        return;
      }
      renderStudents();
    }, 1000);
  }

  // ---- Stopp alle ----
  function stopAll() {
    clearInterval(interval);
    interval = null;

    students.forEach(s => {
      if (s.active) {
        s.active = false;
        s.finished = true;
      }
    });

    timerRunning = false;
    updateStatus();
    renderStudents();
  }

  // ---- Stopp √©n elev ----
  function stopStudent(index) {
    if (!students[index].active) return;
    students[index].active = false;
    students[index].finished = true;
    renderStudents();
  }

  // ---- Slett elev ----
  function deleteStudent(index) {
    if (timerRunning) return;
    students.splice(index, 1);
    renderStudents();
  }

  // ---- Sorter ----
  function sortStudents() {
    students.sort((a, b) =>
      a.name.localeCompare(b.name, 'no', { sensitivity: 'base' })
    );
    renderStudents();
  }

  // ---- Nullstill ----
  function restartTimer() {
    const ok = confirm("Nullstill alle tider og status?");
    if (!ok) return;

    clearInterval(interval);
    interval = null;
    globalTime = 0;
    timerRunning = false;

    students.forEach(s => { s.time = 0; s.active = false; s.finished = false; });

    updateStatus();
    renderStudents();
  }

  // ---- Formater tid ----
  function formatTime(sec) {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return `${m}:${s < 10 ? "0" : ""}${s}`;
  }

  // ---- Eksporter: XLSX ----
  function exportXLSX() {
    // Bygg et 2D-array: f√∏rste rad er header
    const data = [["Navn", "Tid (mm:ss)"]];
    students.forEach(s => {
      data.push([s.name, formatTime(s.time)]);
    });

    // Lag et ark fra array
    const worksheet = XLSX.utils.aoa_to_sheet(data);

    // Autofit kolonnebredder (enkel heuristikk)
    const colWidths = [
      { wch: Math.max(10, ...data.map(r => (r[0] ? String(r[0]).length : 0))) + 2 },
      { wch: 10 }
    ];
    worksheet["!cols"] = colWidths;

    // Lag arbeidsbok og legg til arket
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Tider");

    // Last ned som .xlsx
    XLSX.writeFile(workbook, "tider.xlsx");
  }

  // ---- (Valgfritt) Eksporter CSV ‚Äì beholdt som backup ----
  function exportCSV() {
    let csv = "Navn,Tid\n";
    students.forEach(s => {
      csv += `${s.name},${formatTime(s.time)}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "tider.csv";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  // ---- Status-tekst ----
  function updateStatus() {
    const el = document.getElementById("statusText");
    if (timerRunning) {
      const remaining = Math.max(0, maxTime - globalTime);
      el.textContent = `‚è±Ô∏è √òkt p√•g√•r ${formatTime(remaining)}`;
    } else {
      el.textContent = "";
    }
  }

  // ---- Render ----
  function renderStudents() {
    const container = document.getElementById("studentList");
    container.innerHTML = "";

    const showDelete = !timerRunning;

    students.forEach((s, i) => {
      const div = document.createElement("div");
      div.className = "student";
      if (s.active) div.classList.add("running");
      if (s.finished) div.classList.add("finished");

      div.innerHTML = `
        ${showDelete ? `<button class="deleteBtn" title="Fjern elev" onclick="deleteStudent(${i})">üóëÔ∏è</button>` : ""}
        <span class="name">${s.name}</span>
        <span class="time">${formatTime(s.time)}</span>
      `;

      // Klikk p√• kortet stopper elev (men ikke hvis man trykker s√∏ppelb√∏tta)
      div.onclick = (e) => {
        if (e.target && e.target.classList.contains("deleteBtn")) return;
        stopStudent(i);
      };

      container.appendChild(div);
    });
  }

  // ---- Init ----
  window.onload = () => {
    updateStatus();
    renderStudents();
  };
</script>

</body>

</html>

